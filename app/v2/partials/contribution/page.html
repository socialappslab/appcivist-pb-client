  <main class="appmain" ng-class="{anonymous: isAnonymous}">
    <article class="proposal__single">
      <header class="page__header contributionHeader">
        <div class="row" style="margin-top: 60px">
          <breadcrumb label="proposal.title"></breadcrumb>
        </div>
        <div class="row title_block">
          <h1 class="heading--title" ng-if="!isTitleEdit && userIsAuthor" ng-click="titleToggleEdit()">
            {{proposal.title}}
            <i class="fa fa-edit smalledit" id="titleEditToggle" ng-click="titleToggleEdit()" ng-if="userIsAuthor && !extendedTextIsPeerDoc"></i>
          </h1>
          <h1 class="heading--title" ng-if="!isTitleEdit && !userIsAuthor">{{proposal.title}}
            <i class="fa fa-edit smalledit" id="titleEditToggle" ng-click="titleToggleEdit()" ng-if="userIsAuthor && !extendedTextIsPeerDoc"></i>
          </h1>
          <div class="editableArea text-center" ng-if="isTitleEdit">
            <input ng-model="proposal.title" id="add_proposal__title" name="text" placeholder="{{'Title' | translate}}">
            <button class="btn btn-default btn-join" ng-click="titleToggleEdit()">{{'Cancel' | translate}}</button>
            <button class="btn btn-default btn-join" ng-click="saveTitle()">{{'Save title' | translate}}</button>
          </div>
        </div>

        <div class="row attribution">
          <div style="min-height:40px;">
            <strong style="font-weight:bold">{{'Created by' | translate}}</strong>
            <div ng-if="proposal.creator" style="display:inline-block;margin-left:10px">
              <member-card user="proposal.creator"></member-card>
            </div>
            <span ng-if="!proposal.creator">{{'ANONYMOUS' | translate}}</span>
          </div>
          <div style="min-height:40px;">
            <strong style="font-weight:bold;vertical-align:middle">{{'Shared with' | translate}}</strong>
            <span ng-if="!proposal.authors && !proposal.nonMemberAuthors">{{'ANONYMOUS' | translate}}</span>
            <div ng-repeat="author in proposal.authors | filter: filterCreatorFromAuthors(proposal.creator.uuid)" style="display: inline-block; margin-left: 10px;">
              <member-card user="author"></member-card>
              <i ng-if="(isCurrentAuthor(author) && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin"
                 class="fa fa-trash" style="margin-left: 5px; cursor: pointer;" ng-click="$parent.deleteAuthor(author)"></i>
            </div>
            <div ng-repeat="author in proposal.nonMemberAuthors" style="display: inline-block; margin-left: 10px;">
              <member-card user="author"></member-card>
              <i ng-if="(userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin"
                 class="fa fa-trash" style="margin-left: 5px; cursor: pointer;" ng-click="$parent.deleteNonMemberAuthor(author)"></i>
            </div>
            <div class="liveEdit">
              <input class="btn-sm" type="text" id="authorSearch" name="authors" ng-model="authorQuery"
                     ng-click="authorsChangeOnClick()" ng-change="authorsChangeOnClick()"
                     ng-model-options="{debounce:750}" autocomplete="off">
              <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)"
                 id="authorSearchClose" class="fa fa-times" style="margin-right: 5px;" ng-click="hideSearch('authorSearch')"></i>
              <fieldset class="tags"  id="authorSearchTags">
                <div class="autocomplete authors" ng-class="{ smaller: ldap == false }" ng-if="authorsSuggestionsVisible">
                  <div class="col-sm-5" ng-class="{'col-sm-12': ldap == false }">
                    <div class="text-center" style="padding-top:0" ng-if="ldap == true">
                      <strong style="font-weight:bold">{{ 'Registered users' | translate }}</strong>
                    </div>
                    <ul class="suggestion-list">
                      <li ng-repeat="item in authorsList track by $index" ng-click="$parent.currentAddOnSelect(item)"
                        class="suggestion-item" style="min-height: 50px;">
                        <span ng-bind-html="$parent.currentAddGetText(item)"></span>
                      </li>
                    </ul>
                  </div>
                  <div class="col-sm-7" ng-if="ldap == true">
                    <div class="text-center" style="padding-top:0">
                      <strong style="font-weight:bold">{{ 'Not yet registered' | translate }}</strong>
                    </div>
                    <ul class="suggestion-list">
                      <li ng-repeat="item in ldapList track by $index" ng-click="$parent.currentAddOnSelect(item, true)"
                        class="suggestion-item" style="min-height: 50px;">
                        <span ng-bind-html="$parent.currentAddGetTextLdap(item)"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </fieldset>

              <button ng-click="showSearch('authorSearch')"
                      ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)">
                <i class="fa fa-plus-square"></i>&nbsp;&nbsp;{{'Share' | translate}}
              </button>
              <div style="display:inline-block;position:relative;width:100px;"><span class="attachment-spinner" us-spinner="spinnerSmallOptions" spinner-key="authors-list"></span></div>
            </div>
          </div>
          <p class="small">
            <strong>{{'Created'|translate}}: </strong> {{proposal.creation.replace(' ', 'T').split(' ')[0]+'+00:00' | date : 'medium'}}
            <strong>{{'Last updated'|translate}}: </strong> {{proposal.lastUpdate.replace(' ', 'T').split(' ')[0]+'+00:00' | date : 'medium'}}
            <strong ng-if="proposal.source.toLowerCase().includes('facebook')">{{'Source'|translate}}: </strong>
            <span class="facebook-bookmark" ng-if="proposal.source.toLowerCase().includes('facebook')">
              <a href="{{proposal.sourceUrl}}" target="_blank"><i class="fa fa-lg fa-facebook-square"></i>&nbsp;{{proposal.source === 'social_ideation_facebook' ? 'Facebook' : proposal.source}}</a>
            </span>
          </p>
        </div>
        <div class="instruction-wrapper" ng-if="showInstructions && currentComponent.instructions">
          <div class="instruction" ng-bind-html="trustedHtml(currentComponent.instructions)" />
          <p class="read-more"><button class="btn btn-default" data-toggle="modal" data-target="#instructionsModal">{{ 'Read more' | translate}}</button></p>
        </div>

        <div ng-class="{ 'half-length': showInstructions }">
          <!-- THEME/s -->
          <ul class="row tags" id="field-theme">
            <li class="title">{{(themesLimit == 1 ? 'Theme': 'Themes') | translate}}: </li>

            <!-- DISPLAY THEMES AS ELEMENTS WHEN MORE THAN ONE IS ALLOWED -->
            <li ng-repeat="theme in proposal.themes | filter:{type:'OFFICIAL_PRE_DEFINED'} track by $index"
                ng-if="themesLimit > 1 || themesLimit == -1
                     || (themesLimit == 1 && !userIsCoordinator && !userIsAdmin && (isAnonymous || !userIsAuthor || (userIsAuthor && proposal.status === 'PUBLISHED')))">
              <a style="cursor:default">
                {{theme.title}}
                <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)" class="fa fa-trash" style="margin-left: 5px; cursor: pointer;" ng-click="$parent.deleteTheme(theme)"></i>
              </a>
            </li>

            <!-- EDIT THEME IN DROPDOWN WHEN ONLY ONE IS ALLOWED -->
            <li ng-if="themesLimit == 1 && !isAnonymous
                        && (userIsCoordinator || userIsAdmin
                            || (userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')))">
              <select class="header_select" name="themesSelect" ng-options="theme as theme.title for theme in allThemes track by theme.themeId"
                      ng-model="$parent.selectedTheme" ng-change="selectTheme()" ></select>
              <i ng-if="userIsCoordinator || userIsAdmin || (userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT'))"
                 class="fa fa-trash" style="margin-left: 5px; cursor:pointer;"
                 ng-click="deleteSelectedTheme()" ng-if="selectedTheme"></i>
            </li>

            <!-- EDIT THEME THROUGH BUTTON ADD WHEN MORE THANAN ONE IS ALLOWED -->
            <div class="liveEdit smaller" ng-if="themesLimit > 1 || themesLimit == -1">
              <input class="btn-sm" type="text" id="themeSearch" name="themes" ng-model="themeQuery.query"
                ng-click="themesChangeOnClick()" ng-change="themesChangeOnClick()" autocomplete="off">
              <i ng-if="(userIsCoordinator || userIsAdmin || (userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')))"
                 id="themeSearchClose" class="fa fa-times" style="margin-right: 5px;" ng-click="hideSearch('themeSearch')"></i>
              <fieldset class="tags" id="themeSearchTags">
                <div class="autocomplete" ng-if="themesSuggestionsVisible">
                  <ul class="suggestion-list">
                    <li ng-repeat="item in themesList track by $index" ng-click="$parent.currentAddOnSelect(item)"
                      class="suggestion-item" style="min-height: 50px;">
                      <span ng-bind-html="$parent.currentAddGetText(item)"></span>
                    </li>
                  </ul>
                </div>
              </fieldset>
              <button ng-click="showSearch('themeSearch')"
                      ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)">
                <i class="fa fa-plus-square"></i>&nbsp;&nbsp;{{'Add' | translate}}</button>
            </div>
          </ul>

          <!-- KEYWORDS -->
          <ul class="row tags"  id="field-keyword">
            <li class="title">{{'Keywords'|translate}}: </li>
            <li ng-repeat="theme in proposal.themes | filter:{type:'EMERGENT'}  track by $index">
              <a style="cursor:default">
                {{theme.title}}
                <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)"
                   class="fa fa-trash" style="margin-left: 5px; cursor:pointer" ng-click="$parent.deleteTheme(theme)"></i>
              </a>
              <!--<span ng-if="!$last">,</span>-->
            </li>
            <div class="liveEdit smaller">
              <input class="btn-sm" type="text" id="keywordSearch" name="keywords" ng-model="keywordsQuery"
                ng-click="keywordsChangeOnClick()" ng-change="keywordsChangeOnClick()" autocomplete="off">
              <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)"
                 id="keywordSearchClose" class="fa fa-times" style="margin-right: 5px;" ng-click="hideSearch('keywordSearch')"></i>
              <fieldset class="tags" id="keywordSearchTags">
                <div class="autocomplete" ng-if="keywordsSuggestionsVisible">
                  <ul class="suggestion-list">
                    <li ng-repeat="item in keywordsList track by $index" ng-click="$parent.currentAddOnSelect(item)"
                      class="suggestion-item" style="min-height: 50px;">
                      <span ng-bind-html="$parent.currentAddGetText(item)"></span>
                    </li>
                    <li ng-click="$parent.currentAddOnSelect({'title': keywordsQuery, 'type': 'EMERGENT'})"
                        class="suggestion-item" style="min-height: 50px;">
                      <span ng-bind-html="'<strong>Add New Keyword</strong>'"></span>
                    </li>
                  </ul>
                </div>
              </fieldset>
              <button ng-click="showSearch('keywordSearch')"
                      ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin) && !keywordsLimitReached"><i class="fa fa-plus-square"></i>&nbsp;&nbsp;{{'Add' | translate}}</button>
            </div>
          </ul>

          <!--HEADER CUSTOM FIELDS-->
          <div class="custom-header-fields" ng-if="customHeaderFields.length > 0">
            <!-- TODO: CURRENT implementation only works for customFields of type MULTIPLE_CHOICE and limit 1-->
            <ul class="row tags" id="field-{{field.name.split(' ').join('_')}}" ng-repeat="field in customHeaderFields | filter: {fieldType:'MULTIPLE_CHOICE'}">
              <li class="title">{{ field.name }}:</li>
              <div style="display: inline-block" ng-if="field.limit == 1">
                <li>
                  <!-- Todo support other types of custom field headers, not only those that are represented with a select-->
                  <select class="header_select" name="{{ field.name + '-' + field.customFieldDefinitionId }}"
                          ng-options="option as option.value for option in field.customFieldValueOptions track by option.value"
                          ng-model="custom.valuesDict[field.customFieldDefinitionId][0]"
                          ng-change="checkCustomHeader(field.customFieldDefinitionId, custom.valuesDict[field.customFieldDefinitionId][0].customFieldValueId, option)"
                          ng-if="(userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin"/>

                  <!-- Todo support other types of custom field headers, not only those that are represented with a select-->
                  <span class="header_select" ng-if="!userIsAuthor">{{custom.valuesDict[field.customFieldDefinitionId].value}}</span>
                </li>
              </div>
              <div class="liveEdit smaller" style="display: inline-block" ng-if="field.limit != 1">
                <li ng-repeat="val in custom.valuesDict[field.customFieldDefinitionId] track by $index">
                  <a style="cursor:default">
                    {{val.value}}
                    <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)" class="fa fa-trash" style="margin-left: 5px; cursor:pointer;" ng-click="$parent.deleteCustomValue(val, field.customFieldDefinitionId)"></i>
                  </a>
                  <!--<span ng-if="!$last">,</span>-->
                </li>
                <input class="btn-sm" type="text" id="{{'customSearch_'+field.customFieldDefinitionId}}"
                       name="{{'customfield_'+field.customFieldDefinitionId}}" ng-model="customQuery"
                       ng-click="customChangeOnClick(field.customFieldDefinitionId)"
                       ng-change="customChangeOnClick(field.customFieldDefinitionId)" autocomplete="off">
                <i ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT'))  || userIsCoordinator || userIsAdmin)"
                   id="{{'customSearch_'+field.customFieldDefinitionId+'Close'}}"
                   class="fa fa-times" style="margin-right: 5px;"
                     ng-click="hideSearch('customSearch_'+field.customFieldDefinitionId)"></i>
                <fieldset class="tags" id="customCloseTags">
                  <div class="autocomplete" ng-if="customsSuggestionsVisible[field.customFieldDefinitionId]">
                    <ul class="suggestion-list">
                      <li ng-repeat="item in customList track by $index" ng-click="$parent.currentAddOnSelect(item, false, field.customFieldDefinitionId)"
                        class="suggestion-item" style="min-height: 50px;">
                        <span ng-bind-html="$parent.currentAddGetText(item, false, field)"></span>
                      </li>
                    </ul>
                  </div>
                </fieldset>
                <button ng-click="showSearch('customSearch_'+field.customFieldDefinitionId)"
                        ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)">
                  <i class="fa fa-plus-square"></i>&nbsp;&nbsp;{{ 'Add' | translate }}</button>
              </div>
            </ul>
          </div>
        </div>

        <div class="overlay new_overlay new_overlay_top contribution_toolbar" style="display: inline-flex;">
          <ul class="overlay_buttons">
            <div class="contextual_wrapper">
              <li class="overlay_button action__contextual_menu" ng-mouseenter="cm.isHover = true">
                <a><i class="fa fa-lg fa-cog"></i></a>
              </li>
              <div class="contextual_menu" ng-class="{active: cm.isHover}" ng-mouseleave="cm.isHover = false" style="top: 3em; left: auto;">
                <div class="content">
                  <contribution-contextual-items contribution="proposal" is-proposal-idea-stage="isProposalIdeaStage" is-hover="cm.isHover"></contribution-contextual-items>
                </div>
              </div>
            </div>
            <li class="overlay_button" ng-if="(!campaignConfigs || campaignConfigs['appcivist.campaign.contribution-types'].includes('IDEA') ) && showContributingIdeas">
              <a data-toggle="modal" data-target="#ideas">
                <i class="fa fa-lightbulb-o fa-lg"></i>
                <span>
                  {{'Contributing ideas'|translate}}
                  {{ resources.relatedContributions.length > 0 ? '('+resources.relatedContributions.length+')' : '' }}
                </span>
              </a>
            </li>
            <li class="overlay_button" ng-if="showAttachments">
              <a data-toggle="modal" data-target="#documents">
                <i class="fa fa-file-text-o fa-lg"></i>
                <span>
                  {{'Attachments'|translate}}
                  {{ resources.documents.length > 0 ? '('+resources.documents.length+')' : ''}}
                </span>
              </a>
            </li>
            <li class="overlay_button" ng-if="proposal.type == 'PROPOSAL' && showMedia">
              <a data-toggle="modal" data-target="#media">
                <i class="fa fa-picture-o fa-lg"></i>
                <span>
                  {{'Media'|translate}}
                  {{ resources.media.length > 0 ? '('+resources.media.length+')' : ''}}
                </span>
              </a>
            </li>
            <li class="overlay_button" ng-if="proposal.type == 'PROPOSAL' && showFeedback">
              <a data-toggle="modal" data-target="#feedback">
                <i class="fa fa-star-half-o fa-lg"></i><span>{{'Feedback'|translate}}</span>
              </a>
            </li>
            <li class="overlay_button" ng-if="showHistory">
              <a ng-click="seeHistory()">
                <i class="fa fa-history fa-lg"></i><span>{{'History'|translate}}</span>
              </a>
            </li>
          </ul>
          <ul class="votes">
            <li class="downvote" ng-if="showCommentCount">
                <a class="commentcount"><i class="fa fa-comment"></i> {{ isAnonymous ? proposal.forumCommentCount : totalComments }}</a>
              </li>
            <li class="upvote" ng-if="showUpVote" ng-click="updateFeedback('up')">
              {{upSum}}
              <a class="thumbs-up">
                <i class="fa" ng-class="{'fa-thumbs-o-up': !userFeedback.up, 'fa-thumbs-up': userFeedback.up}"></i>
              </a>
            </li>
            <li class="downvote" ng-if="showDownVote" ng-click="updateFeedback('down')">
                {{downSum}}
              <a class="thumbs-down">
                <i class="fa" ng-class="{'fa-thumbs-o-down': !userFeedback.down, 'fa-thumbs-down': userFeedback.down}"></i>
              </a>
            </li>
            <li class="score" ng-if="proposal.informalScore">
                {{proposal.informalScore}}
              <i class="fa" ng-class="{'fa-arrow-up': proposal.informalScore > 0, 'fa-arrow-down': proposal.informalScore < 0}"></i>
            </li>
          </ul>
          <div class="float-wrapper">
            <button class="btn btn-default follow-contribution" data-toggle="modal" data-target="#followModal"
                    ng-if="contributionType && !following && !isAnonymous">
              {{ ('Follow ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}
            </button>
            <button class="btn btn-default follow-contribution" data-toggle="modal" data-target="#unfollowModal"
                    ng-if="contributionType && following && !isAnonymous">
              {{ ('Unfollow ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}
            </button>
            <button class="btn btn-default fork-contribution" data-toggle="modal" data-target="#forkModal"
                    ng-if="contributionType && !isAnonymous && (proposal.status == 'PUBLISHED' || proposal.status == 'FORKED_PUBLISHED')">
              {{ ('Fork ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}
            </button>
            <button class="btn btn-default fork-contribution" data-toggle="modal" data-target="#mergeModal"
                    ng-if="contributionType && !isAnonymous &&  userIsParentAuthor && proposal.status.includes('FORKED')">
              {{ ('Merge ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}
            </button>
            <!--STATUS VIEW AND CHANGE ELEMENT -->
            <div class="overlay_status" ng-if="contributionType">
              <span class="status_label">{{'Status' | translate}}</span>
              <span class="status" ng-if="proposal.status != 'PUBLISHED' && proposal.status != 'ARCHIVED' && allowChangeStatus && (userIsAuthor || userIsCoordinator || userIsAdmin)">
                <select name="currentStatus" id="currentStatus" ng-model="proposal.status"
                        ng-change="changeStatus(proposal.status, '{{proposal.status}}')">
                  <option value="DRAFT" ng-selected="proposal.status == 'DRAFT'" ng-if="!proposal.status.includes('FORKED')">{{ 'Draft' | translate }}</option>
                  <option value="PUBLIC_DRAFT" ng-selected="proposal.status == 'PUBLIC_DRAFT'" ng-if="!proposal.status.includes('FORKED')">{{'Public draft' | translate}}</option>
                  <option value="PUBLISHED" ng-selected="proposal.status == 'PUBLISHED'" ng-if="!proposal.status.includes('FORKED')">{{ 'Published' | translate }}</option>
                  <option value="ARCHIVED" ng-selected="proposal.status == 'ARCHIVED'" ng-if="(userIsCoordinator || userIsAdmin) && allowArchived">{{ 'Archived' | translate }}</option>
                  <option value="MERGED_PRIVATE_DRAFT" ng-selected="proposal.status == 'MERGED_PRIVATE_DRAFT'" ng-if="!proposal.status.includes('FORKED')">{{ 'Merged Private Draft' | translate }}</option>
                  <option value="MERGED_PUBLIC_DRAFT" ng-selected="proposal.status == 'MERGED_PUBLIC_DRAFT'" ng-if="!proposal.status.includes('FORKED')">{{ 'Merged Public Draft' | translate }}</option>
                  <option value="FORKED_PRIVATE_DRAFT" ng-selected="proposal.status == 'FORKED_PRIVATE_DRAFT'" ng-if="proposal.status.includes('FORKED')">{{'Forked Private Draft' | translate}}</option>
                  <option value="FORKED_PUBLIC_DRAFT" ng-selected="proposal.status == 'FORKED_PUBLIC_DRAFT'" ng-if="proposal.status.includes('FORKED')">{{'Forked Public Draft' | translate}}</option>
                  <option value="FORKED_PUBLISHED" ng-selected="proposal.status == 'FORKED_PUBLISHED'" ng-if="proposal.status.includes('FORKED')">{{'Forked Published' | translate}}</option>
                </select>
              </span>
              <span class="status" ng-if="proposal.status == 'DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin))">{{ 'Draft' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'PUBLIC_DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin)) ">{{'Public draft' | translate}}</span>
              <span class="status" ng-if="proposal.status == 'FORKED_PUBLIC_DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin)) ">{{'Forked Public Draft' | translate}}</span>
              <span class="status" ng-if="proposal.status == 'PUBLISHED'">{{ 'Published' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'ARCHIVED'">{{ 'Archived' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'FORKED_PRIVATE_DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin))">{{ 'Forked Private Draft' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'MERGED_PRIVATE_DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin))">{{ 'Merged Private Draft' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'MERGED_PUBLIC_DRAFT' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin))">{{ 'Merged Public Draft' | translate }}</span>
              <span class="status" ng-if="proposal.status == 'FORKED_PUBLISHED' && (!allowChangeStatus || (!userIsAuthor && !userIsCoordinator && !userIsAdmin))">{{ 'Forked Published' | translate }}</span>

            </div>
            <button class="btn btn-default fork-contribution" data-toggle="modal" data-target="#showParentModal"
                    ng-if="contributionType && proposal.status.includes('FORKED')">
              {{ ('Parent ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}
            </button>
            <button class="btn btn-default fork-contribution" data-toggle="modal" data-target="#showChildrenModal"
                    ng-if="contributionType && !isAnonymous && (userIsAuthor || userIsCoordinator) && (mergeChildren || forkedChildren)">
              {{ ('Amendments') | translate }}
            </button>
          </div>
        </div>
        <div style="clear:both"></div>
      </header>

      <section class="content" ng-if="contributionType == 'PROPOSAL'">
        <div class="proposal-summary" id="field-text">
          <h2 ng-if="showBodyDescriptionTitle">
            {{'contribution.summary' | translate}}
            <i class="fa fa-edit smalledit" id="descriptionEditToggle"
               ng-click="descriptionToggleEdit()" ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)">
            </i>
          </h2>
          <p class="contribution_description" ng-if="isDescriptionEdit && (userIsAuthor || userIsCoordinator || userIsAdmin)">
            {{"contribution.summary.empty" | translate}}&nbsp;&nbsp;
            {{ descriptionLimit ? ("contribution.summary.word-limit" | translate:translateWordLimit) : "" }}
          </p>
          <p class="contribution_description" ng-if="!isDescriptionEdit && (userIsAuthor || userIsCoordinator || userIsAdmin) && (!proposal.text.length || proposal.text.length === 0)">
            {{"contribution.summary.empty" | translate}}&nbsp;&nbsp;
            {{ descriptionLimit ? ("contribution.summary.word-limit" | translate:translateWordLimit) : "" }}
          </p>
          <p class="contribution_description" translate="contribution.summary.empty.non-author"
             ng-if="(!proposal.text || proposal.text == '') && !userIsAuthor">
          </p>
          <p class="contribution_description"
             ng-bind-html="trustedHtml((!showBodyDescriptionTitle ? editIconHTML + '&nbsp;&nbsp;&nbsp;': '') + proposal.text)"
             ng-if="!isDescriptionEdit && showBodyDescription &&  ((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)"
             ng-click="descriptionToggleEdit()">
          </p>
          <p class="contribution_description"
             ng-bind-html="trustedHtml((!showBodyDescriptionTitle ? editIconHTML + '&nbsp;&nbsp;&nbsp;': '') + proposal.text)"
             ng-if="!isDescriptionEdit && showBodyDescription &&  ((userIsAuthor && (proposal.status != 'DRAFT' && proposal.status != 'PUBLIC_DRAFT'))) && !userIsCoordinator && !userIsAdmin">
          </p>
          <p class="contribution_description" ng-bind-html="trustedHtml(proposal.text)"
             ng-if="!isDescriptionEdit && showBodyDescription && (!userIsAuthor && !userIsCoordinator && !userIsAdmin)"></p>
          </p>
          <div class="editableArea text-center" ng-if="isDescriptionEdit && showBodyDescription">
            <textarea ng-if="showDescriptionRichTextEdit" ui-tinymce="tinymceOptions" ng-model="proposal.text"
                      id="add_proposal__description" name="text" rows="8" cols="48"
                      placeholder="{{'Description' | translate}}"></textarea>
            <textarea ng-if="!showDescriptionRichTextEdit"  ng-model="proposal.text" ng-change="enforceLimit()"
                      id="add_proposal__description" name="text" rows="8" cols="48"
                      placeholder="{{'Description' | translate}}"></textarea>
            <button class="btn btn-default btn-join" ng-click="descriptionToggleEdit()">{{'Cancel' | translate}}</button>
            <button class="btn btn-default btn-join" ng-click="saveDescription()">{{'Save description'|translate}}</button>
          </div>
        </div>
        <div class="proposal-text">
          <h2 ng-if="showBodyProposalTitle">{{contributionType | titlecase | translate}}</h2>
          <p translate="contribution.body" ng-if="showProposalIntroInfo"></p>
          <p translate="contribution.body.empty" ng-if="!proposal.extendedTextPad && ((userIsAuthor && (proposal.status != 'DRAFT' && proposal.status != 'PUBLIC_DRAFT')) || userIsCoordinator) && showBodyProposal"></p>
          <p translate="contribution.body.replace" ng-if="proposal.extendedTextPad && ((userIsAuthor && (proposal.status != 'DRAFT' && proposal.status != 'PUBLIC_DRAFT')) || userIsCoordinator) && showProposalIntroInfo"></p>
          <!-- Add document buttons -->
          <div class="text-center" style="margin-top: 2rem" ng-if="!proposal.extendedTextPad && showBodyProposal
                                                          && (userIsCoordinator || userIsAdmin
                                                            || (userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')))">
              <button ng-if="etherpadIsEnabled" class="btn btn-default proposal-btn" data-toggle="modal" data-target="#etherpadEmbedModal">Etherpad</button>
              <button ng-if="gdocIsEnabled" class="btn btn-default proposal-btn" data-toggle="modal" data-target="#gdocEmbedModal">Google Docs</button>
              <button ng-if="peerdocIsEnabled" class="btn btn-default proposal-btn" ng-click="embedPadPeerDoc()">PeerDoc</button>
              <!--<button class="btn btn-default proposal-btn">Default</button>-->
          </div>
          <!-- Notice for non authors or non logged in visitors -->
          <div ng-if="(proposal.status == 'DRAFT' && (isAnonymous || (!userIsAuthor && !userIsCoordinator)))">
            <p class="card card__message" translate="contribution.notice.non-author-or-anonymous"
               translate-value-type="{{proposal.type | lowercase | translate}}"></p>
          </div>
          <!-- Public Draft notice for non authors or non logged in visitors -->
          <div ng-if="(proposal.status == 'PUBLIC_DRAFT' && isAnonymous) && (!userIsAuthor || !userIsCoordinator)">
            <p class="card card__message" translate="contribution.notice.public-draft"
               translate-value-type="{{proposal.type | lowercase | translate}}"></p>
          </div>
          <!-- ETHERPAD -->
          <div class="text-center" style="margin-top: 2rem" ng-if="proposal.extendedTextPad.resourceType==='PAD' && proposal.extendedTextPad && showBodyProposal">
            <div ng-if="!campaignConfigs['appcivist.campaign.disable-etherpad'] || campaignConfigs['appcivist.campaign.disable-etherpad']==='FALSE'"
                 class="etherpad__wrapper">
              <div class="pad-html">
                <iframe ng-if="userIsAuthor && etherpadReadWriteUrl" name="embed_readwrite"
                        ng-src="{{etherpadReadWriteUrl}}" width="100%" height="600px" scrolling="0" frameborder="0">
                </iframe>
                <iframe id="etherpadHTML" ng-if="(!userIsAuthor && etherpadReadOnlyUrl) || !etherpadReadWriteUrl"
                        ng-src="{{etherpadReadOnlyUrl}}" width="100%" height="600px" scrolling="0" frameborder="0"></iframe>
              </div>
            </div>
          </div>
          <!-- GOOGLE DOCS -->
          <div class="text-center" style="margin-top: 2rem" ng-if="proposal.extendedTextPad.resourceType==='GDOC' && proposal.extendedTextPad && showBodyProposal">
            <div class="etherpad__wrapper">
              <!-- TODO: load only HTML of etherpad as obtained from backend, do not embed read only version-->
              <iframe ng-if="(!userIsAuthor && gdocUrl)" name="embed_readonly"
                      ng-src="{{gdocUrlMinimal}}" width="100%" height="600px" id="gdocHTML">
              </iframe>
              <iframe ng-if="userIsAuthor && writegDocUrl" name="embed_readwrite"
                      ng-src="{{writegDocUrl}}" width="100%" height="600px">
              </iframe>
            </div>
          </div>
          <!-- PEERDOC -->
          <div class="text-center" style="margin-top: 2rem"
               ng-if="proposal.extendedTextPad && proposal.extendedTextPad.resourceType==='PEERDOC' && ((proposal.status == 'DRAFT' && userIsAuthor || userIsCoordinator) || (proposal.status == 'PUBLIC_DRAFT' && !isAnonymous) || proposal.status == 'PUBLISHED') && showBodyProposal">
            <div class="etherpad__wrapper">
              <iframe ng-if="(!userIsAuthor && peerDocUrl)" name="embed_readonly"
                ng-src="{{peerDocUrlMinimal}}" width="100%" height="600px" id="peerdocHTML"
                      style="width: 100%; border: 0;" frameborder="0" scrolling="no">
              </iframe>
              <iframe ng-if="writePeerDocUrl" name="embed_readwrite"
                      ng-src="{{writePeerDocUrl}}"
                      width="100%" height="600px" style="width: 100%; border: 0;" frameborder="0" scrolling="no">
              </iframe>
              <script>
                window.addEventListener('message', function (event) {
                  if (event.data.size) {
                    Array.prototype.forEach.call(document.getElementsByTagName('iframe'), function (element) {
                      if (element.contentWindow === event.source) {
                        element.style.height = `${event.data.size.height}px`;
                      }
                    });
                  }
                }, false);
              </script>
            </div>
          </div>
        </div>
        <div class="proposal-summary" id="custom-fields" ng-if="(campaignFields && campaignFields.length) || (componentFields && componentFields.length)">
          <!-- Custom Fields -->
          <div class="field__container">
            <h2 ng-if="showCustomFieldsTitle" class="intro bold">{{'Additional info' | translate}}</h2>
            <custom-field ng-repeat="value in fieldsValues | orderBy:'position'" definition="value.customFieldDefinition"
                          value="value" renderer="readonly" ng-if="showCustomFields"></custom-field>
          </div>
        </div>
      </section>

      <!-- Pictures carousel before idea content -->
      <section class="content" ng-if="contributionType == 'IDEA'">
        <div id="media-carousel" class="carousel slide" data-ride="carousel" data-interval="false" ng-if="resources.pictures.length > 0 && showMediaCarousel">
            <div class="carousel-inner" role="listbox">
              <div class="item" ng-class="{active:$first}" ng-repeat="picture in resources.pictures">
                <img ng-src="{{picture.url}}">
              </div>
            </div>
            <a class="left carousel-control" role="button" data-target="#media-carousel" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">{{'Previous' | translate}}</span>
            </a>
            <a class="right carousel-control" role="button" data-target="#media-carousel" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">{{'Next' | translate}}</span>
            </a>
            <ol class="carousel-indicators">
              <li data-target="#media-carousel" data-slide-to="{{$index}}" ng-class="{active:$first}" ng-repeat="picture in resources.pictures"></li>
            </ol>
          </div>
        <h2 ng-if="showBodyDescriptionTitle">
          {{'contribution.summary'|translate}}
          <i class="fa fa-edit smalledit" id="descriptionEditToggle" ng-click="descriptionToggleEdit()" ng-if="userIsAuthor"></i>
        </h2>
        <p class="contribution_description" ng-bind-html="trustedHtml(proposal.text)"
           ng-if="!isDescriptionEdit && showBodyDescription && (proposal.status != 'DRAFT' || userIsAuthor)"></p>
        <!-- Notice for non authors or non logged in visitors -->
        <div ng-if="(proposal.status == 'DRAFT' && !userIsAuthor) ">
          <p class="card card__message">{{'contribution.notice.non-author-or-anonymous' | translate : proposal}}</p>
        </div>
        <div class="editableArea text-center" ng-if="isDescriptionEdit && showBodyDescription">
          <textarea ui-tinymce="tinymceOptions" ng-model="proposal.text" id="add_proposal__description" name="text" rows="8" cols="48"
                    placeholder="{{'Description' | translate}}"></textarea>
          <button class="btn btn-default btn-join" ng-click="saveDescription()">Save description</button>
        </div>
        <div class="proposal-summary" id="custom-fields" ng-if="(campaignFields && campaignFields.length) || (componentFields && componentFields.length)">
          <!-- Custom Fields -->
          <div class="field__container">
            <h2 ng-if="showCustomFieldsTitle" class="intro bold">{{'Additional info' | translate}}</h2>
            <custom-field ng-repeat="value in fieldsValues | orderBy:'position'" definition="value.customFieldDefinition"
                          value="value" renderer="readonly" ng-if="showCustomFields"></custom-field>
          </div>
        </div>
      </section>

      <section class="comments__section"
               ng-if="!campaignConfigs['appcivist.campaign.disable-proposal-discussions'] || campaignConfigs['appcivist.campaign.disable-proposal-discussions']==='false' || campaignConfigs['appcivist.campaign.disable-proposal-discussions']==='FALSE'">
        <div class="row comments-header">
          <div class="col-xs-4 text-left">
            <strong>{{'Comments'|translate}} ({{commentType == 'members' ? proposal.commentCount : proposal.forumCommentCount}})</strong>
          </div>
          <div class="col-xs-8 text-right">
            {{'View comments by'|translate}}:
            <select name="comment-types" ng-model="commentType">
              <option value="public">{{'Public'|translate}}</option>
              <option value="members">{{'Members only'|translate}}</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="tab-pane" ng-if="userIsMember && commentType === 'members'">
            <discussion-panel class="col-*-12" ng-if="userIsMember" space-id="proposal.rsID"
                              endpoint-id="proposalID"
                              endpoint="contribution"
                              is-anonymous="isAnonymous"></discussion-panel>
          </div>
          <div class="tab-pane" ng-if="commentType === 'public'">
            <discussion-panel ng-if="!isAnonymous" class="col-md-12" space-id="proposal.forumResourceSpaceId"
                              endpoint-id="proposal.proposalId"
                              endpoint="contribution"
                              public-board="true"
                              is-anonymous="isAnonymous"></discussion-panel>
            <discussion-panel ng-if="isAnonymous" class="col-*-12"
                              space-id="proposal.frsUUID"
                              endpoint-id="proposal.uuid"
                              endpoint="contribution"
                              public-board="true"
                              is-anonymous="isAnonymous"></discussion-panel>
          </div>
        </div>
      </section>
    </article>
    <modal open-if="modals.addAttachmentForm" close="closeModal('addAttachmentForm')" title="Edit Form" template-id="addAttachmentForm"></modal>
  </main>


  <!-- Ideas Modal -->
  <div class="modal fade dashboardModal" id="ideas" tabindex="-1" role="dialog" aria-labelledby="documentsLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{'Close'|translate}} &times;</span></button>
          <h3 class="modal-title" id="ideasLabel">{{proposal.title}}</h3>
          <p>{{ 'Contributing ideas' | translate }}</p>
        </div>
        <div class="modal-body">
          <associated-contributions-form ng-if="!isAnonymous && (userIsCoordinator || userIsAdmin || userIsAuthor)"
                                         contribution-type="'idea'"
                                         space-id="proposal.resourceSpaceId"
                                         space="resources"
                                         assembly-id="assemblyID"
                                         campaign-id="campaignID"
                                         campaign-space-id="campaign.resourceSpaceId"
                                         group-id="groupID"
                                         parent-contribution-id="proposalID"></associated-contributions-form>

          <div class="noContent" ng-if="!resources.relatedContributions || resources.relatedContributions.length === 0">
            <h4>{{ 'There are no ideas associated to this contribution' | translate }}</h4>
          </div>
          <ul class="workingGroupList" ng-if="resources.relatedContributions && resources.relatedContributions.length > 0">
            <li ng-repeat="contribution in resources.relatedContributions track by $index">
              <a class="workingGroupLink" ng-href="#/v2/assembly/{{assemblyID}}/campaign/{{campaignID}}/contribution/{{contribution.contributionId}}">
                <span>{{contribution.title|limitTo:37}}{{(contribution.title.length) > 37 ? '...' : '.' }}</span>
              </a>
              <span class="number clickable" ng-click="removeContributingIdea(contribution)"><i class="fa fa-trash"></i>{{'Delete'|translate}}</span>
            </li>
          </ul>
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Documents Modal -->
  <div class="modal fade dashboardModal" id="documents" tabindex="-1" role="dialog" aria-labelledby="documentsLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{'Close'|translate}} &times;</span></button>
          <h3 class="modal-title" id="documentsLabel">{{proposal.title}}</h3>
          <p>{{ 'Attachments' | translate }}</p>
          <button class="btn btn-default follow-contribution modal-button"
                  ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin) && !openAddAttachment"
                  ng-click="toggleOpenAddAttachment()">{{'Add a new file'|translate}}</button>

          <button class="btn btn-default follow-contribution modal-button"
                  ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin) && !openAddAttachment"
                  ng-click="toggleOpenAddAttachmentByUrl()">{{'Add URL resource'|translate}}</button>
        </div>
        <div class="modal-body">
          <!--
            TODO: investigate why simply using the class dashboardModal does not work
            (or adding another class at the same level the noWorkingGroups in new-dashboard.scss)
          -->
          <div ng-include="'/app/v2/partials/contribution/add-attachment-form.html'"></div>
          <span class="attachment-spinner" us-spinner="spinnerOptions" spinner-key="contributions-page"></span>

          <div class="noContent" ng-if="!resources.documents || resources.documents.length === 0">
            <h4>{{ 'There are no documents in this campaign' | translate }}</h4>
          </div>
          <ul class="workingGroupList" ng-if="resources.documents && resources.documents.length > 0">
            <li ng-repeat="resource in resources.documents track by $index">
              <a class="workingGroupLink" target="_blank"
                  ng-href="{{resource.url}}">
                <span>{{resource.title ? resource.title : resource.name}}</span>
              </a>
              <span class="number clickable"
                    ng-if="((userIsAuthor && (proposal.status != 'DRAFT' && proposal.status != 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin)"
                    ng-click="deleteAttachment(resource)"><i class="fa fa-trash"></i>{{'Delete'|translate}}</span>
            </li>
          </ul>
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Media Modal -->
  <div class="modal fade dashboardModal" id="media" tabindex="-1" role="dialog" aria-labelledby="mediaLabel" ng-if="proposal.type == 'PROPOSAL'">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{'Close'|translate}} &times;</span></button>
          <h3 class="modal-title" id="mediaLabel">{{proposal.title}}</h3>
          <p>{{ 'Media' | translate }}</p>
          <button class="btn btn-default follow-contribution modal-button"
                  ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin) && !openAddAttachment"
                  ng-click="toggleOpenAddAttachment()">{{'Add a new file'|translate}}</button>

          <button class="btn btn-default follow-contribution modal-button"
                  ng-if="((userIsAuthor && (proposal.status === 'DRAFT' || proposal.status === 'PUBLIC_DRAFT')) || userIsCoordinator || userIsAdmin) && !openAddAttachment"
                  ng-click="toggleOpenAddAttachmentByUrl()">{{'Add URL resource'|translate}}</button>
        </div>
        <div class="modal-body">
          <!--
            TODO: investigate why simply using the class dashboardModal does not work
            (or adding another class at the same level the noWorkingGroups in new-dashboard.scss)
          -->
          <div ng-include="'/app/v2/partials/contribution/add-attachment-form.html'"></div>
          <span class="attachment-spinner" us-spinner="spinnerOptions" spinner-key="contributions-page"></span>
          <div class="noContent" ng-if="!resources.media || resources.media.length === 0">
            <h4>{{ 'There are no multimedia resources in this proposal' | translate }}</h4>
          </div>

          <!-- Media Carousel in Media Modal-->
          <div id="media-carousel-modal" class="carousel slide" data-ride="carousel" data-interval="false">
            <div class="carousel-inner" role="listbox">
              <div class="item {{$index===0 ? 'active' : ''}}" ng-repeat="resource in resources.media track by $index">
                <img ng-if="resource.resourceType === 'PICTURE'" ng-src="{{resource.url}}" alt="{{resource.name}}">
                <!-- TODO: sanitize video URLs somewhere else -->
                <iframe ng-if="resource.resourceType === 'VIDEO'" width="75%" height="315"
                        ng-src="{{resource.embedUrl}}"
                        frameborder="0" allowfullscreen style="display: block; margin: auto;"></iframe>
                <div class="noContent">
                  <h4 ng-if="resource.title">{{resource.title}}</h4>
                  <h5 ng-if="resource.description"
                      ng-bind-html="resource.description"></h5>
                </div>

              </div>
            </div>
            <!-- Controls -->
            <a class="left carousel-control" data-target="#media-carousel-modal" role="button" data-slide="prev" ng-if="resources.media.length > 0">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">{{'Previous'|translate}}</span>
            </a>
            <a class="right carousel-control" data-target="#media-carousel-modal" role="button" data-slide="next" ng-if="resources.media.length > 0">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">{{'Next'|translate}}</span>
            </a>
            <ol class="carousel-indicators" ng-if="media.length > 0">
              <li data-target="#media-carousel-modal" data-slide-to="{{$index}}" ng-repeat="resource in resources.media track by $index" class="{{$index===0 ? 'active' : ''}}"></li>
            </ol>
          </div>
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal fade dashboardModal" id="feedback" tabindex="-1" role="dialog" aria-labelledby="feedbackLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{'Close'|translate}} &times;</span></button>
          <h3 class="modal-title" id="feedbackLabel">{{proposal.title}}</h3>
          <p>{{ 'Feedback' | translate }}</p>
        </div>
        <div class="modal-body">
          <div class="informal_score">
            <div class="informal_score stats2">
              <div style="margin-bottom: 1rem;">
                <div class="col-xs-6 text-right">
                  <span style="font-weight: bold; margin-right: 1rem;">{{ 'Needs' | translate }}</span>
                </div>
                <div class="col-xs-6">
                  <span class="glyphicon glyphicon-star" ng-class="i" ng-repeat="i in createArray(needAvg) track by $index"></span>
                </div>
              </div>
              <div style="margin-bottom: 1rem;">
                <div class="col-xs-6 text-right">
                  <span style="font-weight: bold; margin-right: 1rem;">{{ 'Feasibility' | translate }} </span>
                </div>
                <div class="col-xs-6">
                  <span class="glyphicon glyphicon-star" ng-class="i" ng-repeat="i in createArray(feasibilityAvg) track by $index"></span>
                </div>
              </div>
              <div style="margin-bottom: 1rem;">
                <div class="col-xs-6 text-right">
                  <span style="font-weight: bold; margin-right: 1rem;">{{ 'Benefit' | translate }}</span>
                </div>
                <div class="col-xs-6">
                  <span class="glyphicon glyphicon-star" ng-class="i" ng-repeat="i in createArray(benefictAvg) track by $index"></span>
                </div>
              </div>
            </div>
            <div class="informal_score stats2">
              <ul>
                <li>
                  <i class="fa fa-lg fa-thumbs-up"></i>
                  {{upSum}}
                </li>
                <li>
                  <i class="fa fa-lg fa-thumbs-down"></i>
                  {{downSum}}
                </li>
                <li>
                  <i class="fa fa-lg" ng-class="{'fa-arrow-up': proposal.informalScore > 0, 'fa-arrow-down': proposal.informalScore < 0}"></i>
                  {{proposal.informalScore}}
                </li>
              </ul>
            </div>
          </div>
          <div class="feedback-list">
            <div class="feedback" ng-repeat="f in userFeedbackArray">
              <div class="labels">
                <div class="icon" ng-if="f.up"><i class="fa fa-lg fa-thumbs-up"></i></div>
                <div class="icon" ng-if="f.down"><i class="fa fa-lg fa-thumbs-down"></i></div>
                <div class="label label-1" ng-if="f.status">{{ f.status }}</div>
                <div class="label label-2" ng-if="f.type">{{ f.type }}</div>
              </div>
              <member-card user="f.user"></member-card>
              <div class="textual" ng-if="f.textualFeedback" ng-bind-html="f.textualFeedback"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscribe when logged in -->
  <div class="modal fade dashboardModal" id="followModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <p> {{ ('Follow ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}</p>
        </div>
        <div class="modal-body">
          <p>{{ ('Would you like to follow this ' + (contributionType == 'PROPOSAL' ? 'proposal' : 'idea') + '?') | translate }}</p>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'No, thank you'|translate}}</button>
          <button class="confirm-modal accept" data-dismiss="modal" ng-click="follow()">{{'Follow' | translate}}</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade dashboardModal" id="forkModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <p> {{ ('Fork ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}</p>
        </div>
        <div class="modal-body">
          <p>{{ ('Would you like to fork this ' + (contributionType == 'PROPOSAL' ? 'proposal' : 'idea') + '?') | translate }}</p>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'No, thank you'|translate}}</button>
          <button class="confirm-modal accept" data-dismiss="modal" ng-click="forkProposal()">{{'Fork' | translate}}</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade dashboardModal" id="mergeModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <p> {{ ('Merge ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}</p>
        </div>
        <div class="modal-body">
          <p>{{ ('Would you like to merge this ' + (contributionType == 'PROPOSAL' ? 'proposal' : 'idea') + '?') | translate }}</p>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'No, thank you'|translate}}</button>
          <button class="confirm-modal accept" data-dismiss="modal" ng-click="mergeProposal()">{{'Merge' | translate}}</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade dashboardModal" id="showParentModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

          <p> {{ 'Parent ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'idea') | translate}}</p>
        </div>
        <div class="modal-body">
        <a data-dismiss="modal" class="workingGroupLink confirm-modal dismiss" ng-click="goToParentOrChildren(proposal.parent.contributionId)">
          <span> {{proposal.parent.title}}</span>
        </a>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'Close'|translate}}</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade dashboardModal" id="showChildrenModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

          <p> {{ 'Amendments ' + (contributionType == 'PROPOSAL' ? 'Proposals' : 'idea') | translate}}</p>
        </div>
        <div class="modal-body">
          <div ng-if="mergeChildren">
            <a data-dismiss="modal" ng-repeat="child in mergeChildren" class="workingGroupLink confirm-modal dismiss" ng-click="goToParentOrChildren(child.contributionId)">
              <span> {{child.title + ' - ' + (child.status|translate)}}</span>
            </a>
            </div>
          <div ng-if="forkedChildren">
            <a data-dismiss="modal" ng-repeat="child in forkedChildren" class="workingGroupLink confirm-modal dismiss" ng-click="goToParentOrChildren(child.contributionId)">
              <span> {{child.title + ' - ' + (child.status|translate)}}</span>
            </a>
          </div>

        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'Close'|translate}}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Unubscribe when logged in -->
  <div class="modal fade dashboardModal" id="unfollowModal" tabindex="-1"
       role="dialog" aria-labelledby="newsletterSubscriptionLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <p> {{ ('Unfollow ' + (contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea')) | translate }}</p>
        </div>
        <div class="modal-body">
          <p>{{ ('Would you like to unfollow this ' + (contributionType == 'PROPOSAL' ? 'proposal' : 'idea') + '?') | translate }}</p>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'No, thank you'|translate}}</button>
          <button class="confirm-modal accept" data-dismiss="modal" ng-click="unfollow()">{{'Unfollow'|translate}}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscribe when not logged in -->
  <div class="modal fade dashboardModal" id="followModalNotLoggedIn"
       tabindex="-1" role="dialog" aria-labelledby="newsletterSubscriptionNotLoggedInLabel" ng-if="!isAnonymous">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <p>Follow {{contributionType == 'PROPOSAL' ? 'Proposal' : 'Idea'}}</p>
        </div>
        <div class="modal-body">
          <p>{{'campaign.newsletter.subscription.question.non-members'|translate}}</p>
        </div>
        <div class="modal-footer">
          <button class="confirm-modal dismiss" data-dismiss="modal">{{'No, thank you'|translate}}</button>
          <button class="confirm-modal accept" data-dismiss="modal">{{'Sign up'}}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add author/theme/keyword modal-->
  <div class="modal fade dashboardModal" id="addToContributionModal" tabindex="-1" role="dialog" aria-labelledby="addToContributionLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{'Close'|translate}} &times;</span></button>
          <h3 class="modal-title" id="addToContributionLabel" ng-if="proposal.type==='PROPOSAL'">{{'Add to proposal'|translate}}</h3>
          <h3 class="modal-title" id="addToContributionLabel" ng-if="proposal.type==='IDEA'">{{'Add to proposal'|translate}}</h3>
          <p>{{ 'Themes, Keywords or Authors' | translate }}</p>
        </div>
        <div class="modal-body">
          <div ng-if="(userIsAuthor || userIsCoordinator || userIsAdmin)" class="row attribution campaign__filters">
            <ul class="search_modes">
              <li class="search_mode__full_text" ng-class="{active: $parent.currentAdd.context === 'THEMES'}">
                <a ng-click="$parent.setAddContext('THEMES')" class="btn-sm">{{ 'Themes' | translate }}</a>
              </li>
              <li class="search_mode__full_text" ng-class="{active: $parent.currentAdd.context === 'AUTHORS'}"
                  ng-if="(userIsAuthor || userIsCoordinator || userIsAdmin)">
                <a ng-click="$parent.setAddContext('AUTHORS')" class="btn-sm">{{ 'Authors'| translate }}</a>
              </li>
              <li class="search_mode__full_text" ng-class="{active: $parent.currentAdd.context === 'KEYWORDS'}">
                <a ng-click="$parent.setAddContext('KEYWORDS')" class="btn-sm">{{ 'Keywords'| translate }}</a>
              </li>
            </ul>
            <br>
            <input class="btn-sm" type="text" name="authors" ng-model="$parent.currentAdd.query"
                   ng-click="$parent.currentAddQueryChangeOnClick()"
                   ng-change="$parent.currentAddQueryChange()" autocomplete="off">
            <fieldset class="tags">
              <div class="autocomplete" ng-if="$parent.currentAdd.suggestionsVisible">
                <ul class="suggestion-list">
                  <li ng-repeat="item in $parent.currentAdd.items track by $index" ng-click="$parent.currentAddOnSelect(item)"
                      class="suggestion-item" style="min-height: 50px;">
                    <span ng-bind-html="$parent.currentAddGetText(item)"></span>
                  </li>
                  <li ng-if="$parent.currentAdd.context === 'KEYWORDS'" ng-click="$parent.currentAddOnSelect({'title': $parent.currentAdd.query, 'type': 'EMERGENT'})"
                      class="suggestion-item" style="min-height: 50px;">
                    <span ng-bind-html="'<strong>Add New Keyword</strong>'"></span>
                  </li>
                </ul>
              </div>
            </fieldset>
          </div>
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Instructions modal -->
  <div class="modal fade dashboardModal" id="instructionsModal"
       tabindex="-1" role="dialog" ng-if="showInstructions && currentComponent.instructions">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close big" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <div ng-bind-html="trustedHtml(currentComponent.instructions)" />
        </div>
        <div class="modal-footer text-left">
          <a data-dismiss="modal"><i class="fa fa-arrow-left fa-lg"></i>{{ 'Return to' | translate }} {{proposal.title}}</a>
        </div>
      </div>
    </div>
  </div>

  <contribution-embed-modal assembly-id="assemblyID" campaign-id="campaignID" contribution-id="proposalID" format="gdoc" resources="campaignResources"></contribution-embed-modal>
  <contribution-embed-modal assembly-id="assemblyID" campaign-id="campaignID" contribution-id="proposalID" format="etherpad" resources="campaignResources"></contribution-embed-modal>

  <script>
    $(document).ready(function() {
      $("a.carousel-control").on("click", function(e) {
        e.preventDefault();
      })
    })
  </script>

<!-- MOTIVATIONAL MESSAGES -->
<motivational page="contribution" resource="proposal"></motivational>

<!-- CONSENT MODAL -->
<consent-modal campaign="campaign" config="campaignConfigs" assembly="assemblyID" user="user"></consent-modal>

<!-- EMAIL UPDATE MODAL -->
<email-update-modal campaign="campaign" config="campaignConfigs" assembly="assemblyID" user="user"></email-update-modal>
